<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Animal Rights Entrepreneurs Seattle - A community of innovators working on diverse projects to advance animal welfare through technology and social movements."
    />
    <title>Animal Rights Entrepreneurs Seattle</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="impact-animation.js" defer></script>
  </head>
  <body>
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-background"></div>
        <div class="container">
            <h1 class="hero-title">Animal Rights Entrepreneurs</h1>
            <p class="hero-subtitle">
                <span class="location-badge">
                    <span class="globe-icon">üåç</span>
                    The Seattle Chapter
                </span>
            </p>
            <p class="hero-description">A community of friends working to advance animal welfare through technology, outreach, and social change.</p>
            <a href="#join" class="cta-button">Join Our Community</a>
        </div>
    </section>

    <!-- About Section -->
    <section class="about">
      <div class="container">
        <h2>Who We Are</h2>
        <p>
          We're a diverse group of entrepreneurs, technologists, and advocates
          united by a common goal: creating meaningful impact for animals. Our
          members work on innovative projects that span technology, science, and
          social activism.
        </p>
      </div>
    </section>

    <!-- Impact Section -->
    <section class="impact">
        <div class="container">
            <h2>What We've Done</h2>
            <p class="impact-description">Collectively, we've started to make a difference</p>
            <div class="impact-metrics">
                <div class="impact-metric">
                    <span class="impact-number" data-target="3200">2000</span>
                    <span class="impact-label">Dollars Raised in Funds</span>
                </div>
                <div class="impact-metric">
                    <span class="impact-number" data-target="121000">120000</span>
                    <span class="impact-label">People Reached</span>
                </div>
            </div>
        </div>
      </div>
    </section>

    <!-- Projects Section -->
    <section class="projects">
      <div class="container">
        <h2>Our Projects</h2>
      </div>
      <div class="carousel-container">
        <button class="carousel-nav prev" aria-label="Previous projects">‚Üê</button>
        <button class="carousel-nav next" aria-label="Next projects">‚Üí</button>
        <div class="project-carousel" id="project-carousel">
          <div class="project-card loading">
            <div class="project-icon">‚è≥</div>
            <h3>Loading projects...</h3>
            <p>Fetching project data from the server.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Meetings Section -->
    <section class="meetings">
      <div class="container">
        <h2>Join Our Meetings</h2>
        <div class="meeting-info">
          <a href="">
            <div class="meeting-detail">
              <span class="meeting-icon">üìÖ</span>
              <div>
                <h3>Every Other Thursday</h3>
                <p>6:30 PM Pacific Time</p>
              </div>
            </div>
          </a>
          <p class="meeting-description">
            Connect with fellow entrepreneurs, share ideas, collaborate on
            projects, and build the future of animal advocacy together.
          </p>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="cta" id="join">
      <div class="container">
        <h2>Ready to Make an Impact?</h2>
        <p>
          Join our Discord community to connect with members, stay updated on
          meetings, and collaborate on projects.
        </p>
        <a
          href="#"
          class="cta-button primary"
          onclick="alert('Please replace this link with your actual Slack invite URL'); return false;"
          >Join Our Discord</a
        >
      </div>
    </section>

    <!-- Footer -->
    <footer>
      <div class="container">
        <p>
          &copy; 2025 Animal Rights Entrepreneurs Seattle. Building a better
          future for all animals.
        </p>
      </div>
    </footer>

    <script>
      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          const href = this.getAttribute("href");
          if (href !== "#") {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          }
        });
      });

      // Icon mapping for projects
      const projectIcons = {
        'chicken-nor-egg': 'üêî',
        'ahimsa-in-action': 'üïäÔ∏è',
        'kind-state': 'üé¨',
        'clean-meat-alliance': 'üß¨',
        'feeding-progress': 'üìù',
        'vishnus-thoughts': 'üí≠',
        'viniths-thoughts': 'üìñ',
        'coffee-buddy': '‚òï',
        'just-another-day-at-work': 'üè¢',
      };

      // Fallback: convert handle to display name (e.g., "chicken-nor-egg" -> "Chicken Nor Egg")
      function formatProjectName(handle) {
        return handle
          .split('-')
          .map(word => word.charAt(0).toUpperCase() + word.slice(1))
          .join(' ');
      }

      // Fetch and render projects
      async function loadProjects() {
        const carousel = document.getElementById('project-carousel');

        try {
          const response = await fetch('/api/projects');
          const data = await response.json();

          if (data.error) {
            throw new Error(data.error);
          }

          if (!data.projects || data.projects.length === 0) {
            carousel.innerHTML = `
              <div class="project-card">
                <div class="project-icon">üì≠</div>
                <h3>No Projects Yet</h3>
                <p>Check back soon for our upcoming initiatives.</p>
              </div>
            `;
            return;
          }

          // Render project cards
          carousel.innerHTML = data.projects.map(project => {
            const icon = projectIcons[project.project_handle] || 'üå±';
            const name = project.project_name || formatProjectName(project.project_handle);
            const description = project.project_description || 'An ARE Seattle initiative.';
            const website = project.project_website;

            const content = `
              <div class="project-icon">${icon}</div>
              <h3>${name}</h3>
              <p>${description}</p>
            `;

            if (website) {
              return `
                <div class="project-card">
                  <a href="${website}" target="_blank" rel="noopener">${content}</a>
                </div>
              `;
            }

            return `<div class="project-card">${content}</div>`;
          }).join('');

          // Initialize carousel after projects are loaded
          initCarousel();

        } catch (error) {
          console.error('Failed to load projects:', error);
          carousel.innerHTML = `
            <div class="project-card">
              <div class="project-icon">‚ö†Ô∏è</div>
              <h3>Unable to Load Projects</h3>
              <p>Please try refreshing the page.</p>
            </div>
          `;
        }
      }

      // Load projects on page load
      loadProjects();

      // Project Carousel - Infinite Loop with 3 Cards Visible
      function initCarousel() {
      const carouselContainer = document.querySelector(".carousel-container");
      const carousel = document.querySelector(".project-carousel");
      const originalCards = Array.from(
        document.querySelectorAll(".project-card")
      );

      let currentIndex = 0;
      let isDragging = false;
      let startX = 0;
      let currentTranslate = 0;
      let prevTranslate = 0;
      let animationID = 0;
      let isTransitioning = false;

      // Clone cards for infinite loop (3 sets: before, original, after)
      const clonedBefore = originalCards.map((card) => card.cloneNode(true));
      const clonedAfter = originalCards.map((card) => card.cloneNode(true));

      // Insert clones in reverse order to maintain correct sequence
      clonedBefore
        .reverse()
        .forEach((card) => carousel.insertBefore(card, carousel.firstChild));
      clonedAfter.forEach((card) => carousel.appendChild(card));

      const allCards = carousel.querySelectorAll(".project-card");
      const totalOriginalCards = originalCards.length;

      // Start at the first original card (after the cloned set)
      currentIndex = totalOriginalCards;

      function getCardWidth() {
        return allCards[0].offsetWidth;
      }

      function getGap() {
        return 35;
      }

      function setPositionByIndex(animated = true) {
        const cardWidth = getCardWidth();
        const gap = getGap();
        currentTranslate = -currentIndex * (cardWidth + gap);
        carousel.style.transition = animated
          ? "transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)"
          : "none";
        carousel.style.transform = `translateX(${currentTranslate}px)`;
        prevTranslate = currentTranslate;
      }

      function handleTransitionEnd() {
        if (!isTransitioning) return;

        // After transition completes, check if we need to loop
        // We have 3 sets: [clones 0-7][originals 8-15][clones 16-23]
        // We want to stay in the middle set (8-15)

        if (currentIndex >= totalOriginalCards * 2) {
          // Scrolled right into clone set (16+), wrap back to middle set
          // Example: index 16 -> 8, index 17 -> 9, etc.
          currentIndex = currentIndex - totalOriginalCards;
          carousel.style.transition = "none";
          const cardWidth = getCardWidth();
          const gap = getGap();
          currentTranslate = -currentIndex * (cardWidth + gap);
          carousel.style.transform = `translateX(${currentTranslate}px)`;
          prevTranslate = currentTranslate;
          // Force reflow
          void carousel.offsetHeight;
        } else if (currentIndex < totalOriginalCards) {
          // Scrolled left into clone set (0-7), wrap forward to middle set
          // Example: index 7 -> 15, index 6 -> 14, etc.
          currentIndex = currentIndex + totalOriginalCards;
          carousel.style.transition = "none";
          const cardWidth = getCardWidth();
          const gap = getGap();
          currentTranslate = -currentIndex * (cardWidth + gap);
          carousel.style.transform = `translateX(${currentTranslate}px)`;
          prevTranslate = currentTranslate;
          // Force reflow
          void carousel.offsetHeight;
        }

        isTransitioning = false;
      }

      carousel.addEventListener("transitionend", handleTransitionEnd);

      function setCarouselPosition() {
        carousel.style.transform = `translateX(${currentTranslate}px)`;
      }

      function touchStart(event) {
        isDragging = true;
        startX = getPositionX(event);
        animationID = requestAnimationFrame(animation);
        carouselContainer.style.cursor = "grabbing";
        carousel.style.transition = "none";
      }

      function touchMove(event) {
        if (isDragging) {
          const currentPosition = getPositionX(event);
          currentTranslate = prevTranslate + currentPosition - startX;
        }
      }

      function touchEnd() {
        isDragging = false;
        cancelAnimationFrame(animationID);
        carouselContainer.style.cursor = "grab";

        const movedBy = currentTranslate - prevTranslate;

        // Swipe threshold - move one card at a time
        if (movedBy < -100) {
          currentIndex += 1;
          isTransitioning = true;
        } else if (movedBy > 100) {
          currentIndex -= 1;
          isTransitioning = true;
        }

        setPositionByIndex(true);
      }

      function getPositionX(event) {
        return event.type.includes("mouse")
          ? event.pageX
          : event.touches[0].clientX;
      }

      function animation() {
        setCarouselPosition();
        if (isDragging) requestAnimationFrame(animation);
      }

      // Initialize position
      setPositionByIndex(false);

      // Mouse events
      carouselContainer.addEventListener("mousedown", touchStart);
      carouselContainer.addEventListener("mousemove", touchMove);
      carouselContainer.addEventListener("mouseup", touchEnd);
      carouselContainer.addEventListener("mouseleave", touchEnd);

      // Touch events
      carouselContainer.addEventListener("touchstart", touchStart);
      carouselContainer.addEventListener("touchmove", touchMove);
      carouselContainer.addEventListener("touchend", touchEnd);

      // Prevent context menu on long press
      carouselContainer.addEventListener("contextmenu", (e) =>
        e.preventDefault()
      );

      // Trackpad/Mouse wheel scrolling - only intercept horizontal scrolls
      let scrollTimeout;
      let scrollAccumulator = 0;

      carouselContainer.addEventListener(
        "wheel",
        (e) => {
          const isHorizontalScroll = Math.abs(e.deltaX) > Math.abs(e.deltaY);

          // Only prevent default and handle if it's a horizontal scroll
          if (isHorizontalScroll) {
            e.preventDefault();

            // Ignore scroll events while transitioning
            if (isTransitioning) {
              return;
            }

            // Accumulate horizontal scroll
            scrollAccumulator += e.deltaX;

            clearTimeout(scrollTimeout);

            scrollTimeout = setTimeout(() => {
              // Determine direction based on accumulated scroll
              if (Math.abs(scrollAccumulator) > 50) {
                if (scrollAccumulator > 0) {
                  currentIndex += 1;
                  isTransitioning = true;
                } else {
                  currentIndex -= 1;
                  isTransitioning = true;
                }
                setPositionByIndex(true);
              }
              scrollAccumulator = 0;
            }, 0);
          }
          // Otherwise let vertical scroll pass through normally
        },
        { passive: false }
      );

      // Update on window resize
      window.addEventListener("resize", () => {
        setPositionByIndex(false);
      });

      // Navigation Buttons
      const prevBtn = document.querySelector(".carousel-nav.prev");
      const nextBtn = document.querySelector(".carousel-nav.next");

      prevBtn.addEventListener("click", () => {
        if (isTransitioning) return;
        currentIndex -= 1;
        isTransitioning = true;
        setPositionByIndex(true);
      });

      nextBtn.addEventListener("click", () => {
        if (isTransitioning) return;
        currentIndex += 1;
        isTransitioning = true;
        setPositionByIndex(true);
      });
      } // end initCarousel
    </script>
  </body>
</html>
